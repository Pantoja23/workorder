<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Pantoja Tile | Master Admin</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root{
--primary:#6366f1;--bg:#070b14;--card:rgba(30,41,59,.7);
--text:#f8fafc;--accent:#22c55e;--warning:#f59e0b;--danger:#ef4444;
--neon-green:#00ff8c;--neon-red:#ff0055;--neon-blue:#00c8ff;
}
body{
margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--text);
background-image:radial-gradient(circle at top right,#1e1b4b,#070b14);
}
.container{max-width:1100px;margin:auto;padding:15px}
.card{
background:var(--card);border-radius:20px;padding:20px;
border:1px solid rgba(255,255,255,.08);backdrop-filter:blur(10px)
}
input,select,textarea{
width:100%;padding:12px;border-radius:12px;
border:1px solid #334155;background:#0f172a;color:white
}
.btn{
border:none;border-radius:12px;padding:10px 16px;
font-weight:700;cursor:pointer;display:inline-flex;gap:8px
}
.btn-save{background:var(--primary);color:white}
.btn-pay-global{background:var(--warning)}
.staff-tag{padding:6px 10px;border-radius:12px;font-size:12px}
.status-ok{border:2px solid var(--neon-green);color:var(--neon-green)}
.status-lejos{border:2px solid var(--neon-red);color:var(--neon-red)}
.status-terminado{border:2px solid var(--neon-blue);color:var(--neon-blue)}
.modal{
position:fixed;inset:0;background:rgba(0,0,0,.9);
display:none;align-items:center;justify-content:center;z-index:2000
}
</style>
</head>

<body>

<!-- üîê LOGIN -->
<div id="loginScreen" style="
position:fixed;inset:0;background:#070b14;
display:flex;align-items:center;justify-content:center;z-index:5000;">
<div class="card" style="width:320px;text-align:center">
<h2 style="color:var(--primary)">PANTOJA ADMIN</h2>
<input id="login_user" placeholder="Usuario">
<input id="login_pass" type="password" placeholder="PIN">
<button class="btn btn-save" onclick="login()">ENTRAR</button>
<p id="login_error" style="color:red;font-size:12px;display:none">Acceso denegado</p>
</div>
</div>

<!-- APP -->
<div class="container">
<header style="text-align:center">
<img src="img/logo.png" height="60" onerror="this.src='https://via.placeholder.com/150x60'">
<h2>PANTOJA <span style="color:var(--primary)">TILE</span></h2>
</header>

<div class="card">
<label>ID ORDEN</label>
<input id="id_orden" readonly>
<label>PRESUPUESTO</label>
<input id="presupuesto" type="number">
<button class="btn btn-save" onclick="guardarOrden()">CREAR PROYECTO</button>
</div>

<div style="margin-top:20px">
<button class="btn btn-pay-global">GENERAR N√ìMINA</button>
</div>

<table width="100%" style="margin-top:20px">
<tbody id="lista_trabajos"></tbody>
</table>
</div>

<script>
/* =========================
   üîê LOGIN JSON
========================= */
let USERS = [];

async function loadUsers(){
    const res = await fetch("img/users.json");
    const data = await res.json();
    USERS = data.users;
}

function login(){
    const u = login_user.value.trim();
    const p = login_pass.value.trim();

    const user = USERS.find(x=>x.user===u && x.pass===p && x.active);
    if(!user){
        login_error.style.display="block";
        return;
    }

    sessionStorage.setItem("auth",JSON.stringify(user));
    loginScreen.style.display="none";
    applyRole(user.role);
}

function checkSession(){
    const auth = sessionStorage.getItem("auth");
    if(auth){
        loginScreen.style.display="none";
        applyRole(JSON.parse(auth).role);
    }
}

function applyRole(role){
    if(role!=="admin"){
        document.querySelectorAll(".btn-pay-global").forEach(b=>b.remove());
    }
}

loadUsers();
checkSession();

/* =========================
   üåê TU BACKEND
========================= */
const URL_SCRIPT="https://script.google.com/macros/s/AKfycbxM0LGmOrIz7wr17ACNChjbOoNnrpYwVwriUvW5hEsIpvt99XrP7KouQbNym99S0dM1QQ/exec";

async function guardarOrden(){
    const payload={
        action:"CREATE_ORDER",
        id:id_orden.value,
        presupuesto:presupuesto.value
    };
    await fetch(URL_SCRIPT,{method:"POST",mode:"no-cors",body:JSON.stringify(payload)});
    alert("Proyecto creado");
}
</script>

</body>
</html>
